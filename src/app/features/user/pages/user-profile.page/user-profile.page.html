<app-user-form-components [loading]="loading()" [user]="userResult()?.result!" [authUser]="authUser()!"/>

<app-section-header-component
  title="Perfil" 
  routeText="Volver"
/>

@if (loading()) {
  <section class="p-4 flex justify-center">
    <app-loading-component/>
  </section>
} @else {
  @if (!userResult()?.isSuccess) {
    <div class="ps-4">
      <app-message-error-component [message]="userResult()?.message"/>
    </div>
  }
}

@if (formErrorMessage()) {
  <div class="mt-4">
    <app-message-error-component [message]="formErrorMessage()"/>
  </div>
}

<!-- Formulario -->
<div class="w-full max-w-2xl m-auto p-4">
  <form 
    (submit)="onSubmit($event)"
    class="fieldset bg-my-light rounded-box border p-6 flex flex-col gap-4">
    
    <section class="flex gap-4 flex-wrap">
      <img 
        class="rounded-full"
        [ngSrc]="authUser()?.picture || 'images/book.png'" 
        [alt]="authUser()?.name"
        onerror="this.src='images/book.png'"
        width="100" height="100" priority>
      <div class="grid w-md">
        <input [value]="authUser()?.role" type="text" placeholder="Sin Rol" class="text-my-purple font-bold" disabled />
        <input [value]="authUser()?.id_user"  type="text" placeholder="Sin Id" class="text-my-purple text-md font-bold" disabled />
        <input [value]="(userResult()?.result?.created_at | date:'yyyy-MM-dd HH:mm:ss') + ' (Creado)'" type="text" placeholder="Fecha" class="text-my-purple text-md font-bold" disabled />
        <input [value]="(userResult()?.result?.updated_at | date:'yyyy-MM-dd HH:mm:ss') + ' (Modificado)'" type="text" placeholder="Fecha" class="text-my-purple text-md font-bold" disabled />
        <input [value]="authUser()?.email" type="text" placeholder="Sin Email" class="text-my-purple text-xl font-bold" disabled />
      </div>
    </section>
 
    <input [value]="'Estado: ' + userResult()?.result?.user_status_id" type="text" placeholder="Estado" class="text-my-purple text-xl" disabled />

    <fieldset class="fieldset flex flex-col">
      <label class="label font-semibold mb-1">Teléfono</label>
      <div class="flex">
        <input value="+ 56" type="text" class="text-my-purple text-base w-12 text-center" disabled />
        <div>
          <input 
            type="text" class="input validator" placeholder="987654321" required
            [value]="formData().phone"
            (input)="updatePhone($any($event.target).value)"
          />
          <p class="validator-hint hidden mt-1 text-sm text-red-500">Requerido</p>
        </div>
      </div>
    </fieldset>
    
    <fieldset class="fieldset flex flex-col">
      <label class="label font-semibold mb-1">Nombre</label>
      <input 
        type="text" class="input validator w-full" placeholder="Nombre" required 
        [value]="formData().name"
        (input)="updateName($any($event.target).value)"
      />
      <p class="validator-hint hidden mt-1 text-sm text-red-500">Requerido</p>
    </fieldset>
    
    <fieldset class="fieldset flex flex-col">
      <label class="label font-semibold mb-1">Apellido</label>
      <input 
        type="text" class="input validator w-full" placeholder="Apellido" required
        [value]="formData().lastname"
        (input)="updateLastname($any($event.target).value)"
      />
      <p class="validator-hint hidden mt-1 text-sm text-red-500">Requerido</p>
    </fieldset>

    <fieldset class="fieldset flex flex-col">
      <label class="label font-semibold mb-1">Rut</label>
      <input 
        type="text" class="input validator w-full" placeholder="12345678-9" required
        [value]="formData().rut"
        (input)="updateRut($any($event.target).value)"
      />
      <p class="validator-hint hidden mt-1 text-sm text-red-500">Requerido</p>
    </fieldset>
    
    <fieldset class="fieldset flex flex-col">
      <label class="label font-semibold mb-1">Dirección</label>
      <input 
        type="text" class="input validator w-full" placeholder="Dirección" required
        [value]="formData().address"
        (input)="updateAddress($any($event.target).value)"
      />
      <p class="validator-hint hidden mt-1 text-sm text-red-500">Requerido</p>
    </fieldset>

    <fieldset class="fieldset flex flex-col">
      <label class="label font-semibold mb-1">Comuna</label>
      <app-commune-select-components/>
      <p class="validator-hint hidden mt-1 text-sm text-red-500">Requerido</p>
    </fieldset>

    <app-message-error-component message="Debes completar tu perfil"/>

    <!-- Botón de envío -->
    <button class="btn bg-my-purple text-my-light mt-4 self-start px-6 py-2 rounded-lg font-semibold" type="submit">
      Modificar
    </button>
  </form>
</div>

<pre>{{ authUser() | json }}</pre>
<pre>{{ userResult() | json }}</pre>

